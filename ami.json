{ 
  "variables" : {
    "region" : "us-west-1",
    "source_ami" : "ami-010c0d7fc6d401cc5",
    "buildId" : "",
    "jenkinsBuildId" : "",
    "artifactId" : "",
    "fallback_artifact" : "petclinic",
    "fallback_build_id" : "default-build"
  },
  "builders" : [
    {
      "type" : "amazon-ebs",
      "profile" : "default",
      "region" : "{{user `region`}}",
      "instance_type" : "t2.micro",
      "source_ami" : "{{user `source_ami`}}",
      "ssh_username" : "ubuntu",
      "ami_name" : "{{coalesce `artifactId` `fallback_artifact`}}-{{coalesce `jenkinsBuildId` `fallback_build_id`}}-{{timestamp}}",
      "ami_description" : "PetClinic Amazon Ubuntu Image",
      "run_tags" : {
        "Name" : "{{user `artifactId` `fallback_artifact`}}-{{user `jenkinsBuildId` `fallback_build_id`}}"
      },
      "tags" : {
        "Tool" : "Packer",
        "Name" : "{{user `artifactId` `fallback_artifact`}}-{{user `jenkinsBuildId` `fallback_build_id`}}",
        "build_id" : "{{user `artifactId` `fallback_artifact`}}-{{user `jenkinsBuildId` `fallback_build_id`}}",
        "Author" : "ochoa"
      }
    }
  ],
  "provisioners": [
    {
      "type" : "file",
      "source" : "./{{user `buildId`}}",
      "destination" : "/tmp/{{user `buildId`}}"
    },
    {
      "type" : "file",
      "source" : "./petclinic.sh",
      "destination" : "/tmp/petclinic.sh"
    },
    {
      "type" : "file",
      "source" : "./petclinic.service",
      "destination" : "/tmp/petclinic.service"
    },
    {
      "type": "shell",
      "script": "./install_app.sh",
      "execute_command" : "sudo -E -S sh '{{ .Path }}' {{ user `buildId`}}"
    }
  ]
}
